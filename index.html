<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora SCORE PROPIO Mortalidad C. Difficile</title>
    
    <style>
        :root {
            --primary-color: #007BFF;
            --secondary-color: #6C757D;
            --background-color: #f8f9fa;
            --card-background: #ffffff;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --border-radius: 10px;
            --font-family: 'Arial', sans-serif;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
        }

        .calculator-container {
            max-width: 800px;
            width: 100%;
            background-color: var(--card-background);
            padding: 30px;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
        }

        h1 {
            color: var(--primary-color);
            text-align: center;
            border-bottom: 2px solid #E0E0E0;
            padding-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: var(--secondary-color);
            margin-bottom: 25px;
        }

        h2 {
            color: #343A40;
            margin-top: 30px;
            border-left: 5px solid var(--primary-color);
            padding-left: 10px;
        }

        .score-group {
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            background-color: #F4F6F9;
            border: 1px solid #e9ecef;
        }

        .score-group h3 {
            color: #495057;
            margin-top: 0;
            margin-bottom: 10px;
            font-size: 1.1em;
            font-weight: bold;
        }

        .checkbox-label {
            display: block;
            padding: 10px;
            margin-bottom: 8px;
            background-color: var(--card-background);
            border: 1px solid #dee2e6;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .checkbox-label:hover {
            background-color: #E9ECEF;
        }

        .checkbox-label input[type="checkbox"] {
            margin-right: 10px;
            appearance: none; 
            width: 16px;
            height: 16px;
            border: 2px solid var(--secondary-color);
            border-radius: 3px;
            vertical-align: middle;
            position: relative;
            top: -1px;
        }

        .checkbox-label input[type="checkbox"]:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .checkbox-label input[type="checkbox"]:checked::after {
            content: '✓';
            color: white;
            font-size: 12px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .age-selector {
            margin-top: 15px;
            padding: 10px;
            background-color: #f1f1f1;
            border-radius: 5px;
        }

        .age-selector select {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ced4da;
            width: 100%;
            margin-top: 5px;
            box-sizing: border-box;
        }

        button {
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1.2em;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            margin-top: 20px;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:active {
            transform: translateY(1px);
        }

        .results-area {
            margin-top: 30px;
            padding: 25px;
            border-radius: var(--border-radius);
            background-color: #E6F0FF; 
            border: 1px solid var(--primary-color);
        }

        .results-area.hidden {
            display: none;
        }

        #total-score {
            font-size: 1.8em;
            font-weight: bold;
            color: var(--primary-color);
        }

        .mortality-result strong {
            font-size: 1.4em;
            color: #D32F2F; 
        }

        .risk-indicator {
            padding: 15px;
            border-radius: 8px;
            color: white;
            text-align: center;
            margin: 15px 0;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        #group-name {
            font-size: 1.3em;
        }

        .cutoff-info, footer {
            margin-top: 20px;
            font-size: 0.9em;
            color: var(--secondary-color);
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="calculator-container">
        <h1>SCORE PROPIO: Mortalidad en Infección por C. Difficile</h1>
        [cite_start]<p class="subtitle">Base nacional española[cite: 2]. [cite_start]Puntuación total posible: 33 puntos[cite: 3].</p>

        <div id="score-form">
            [cite_start]<h2>Variables Clínicas y Comorbilidades [cite: 1]</h2>
            
            <div class="score-group four-points">
                <h3>4 Puntos</h3>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="4"> Megacolon
                </label>
            </div>

            <div class="score-group three-points">
                <h3>3 Puntos</h3>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="3"> Shock
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="3"> Sepsis sin shock
                </label>
            </div>

            <div class="score-group two-points">
                <h3>2 Puntos</h3>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="2"> Malignidad con metástasis
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="2"> Cirrosis hepática
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="2"> Linfoma
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="2"> Leucemia
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="2"> Íleo paralítico
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="2"> Lesión renal aguda (Acute kidney injury)
                </label>
                
                <div class="age-selector">
                    <label for="age-select">Edad (por cada 20 años):</label>
                    <select id="age-select" data-points="2">
                        <option value="0">0 - 19 años (0 puntos)</option>
                        <option value="1">20 - 39 años (2 puntos)</option>
                        <option value="2">40 - 59 años (4 puntos)</option>
                        <option value="3">60 - 79 años (6 puntos)</option>
                        <option value="4">80 - 99 años (8 puntos)</option>
                        <option value="5">100+ años (10 puntos)</option>
                    </select>
                </div>
            </div>

            <div class="score-group one-point">
                <h3>1 Punto</h3>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="1"> Insuficiencia cardíaca crónica
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="1"> Enfermedad pulmonar crónica
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="1"> Malignidad de órgano sólido (sin metástasis)
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="1"> Ictus previo (Previous stroke)
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="1"> Deterioro cognitivo
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="1"> Malnutrición
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="1"> Arteriopatía periférica
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="1"> Infarto cardíaco previo
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" data-points="1"> Sexo (masculino)
                </label>
            </div>

            <button onclick="calculateScore()">Calcular Score</button>
        </div>

        <div id="results-area" class="results-area hidden">
            <h2>Resultados</h2>
            <p>Puntuación Total: <span id="total-score">0</span> puntos</p>
            
            <div id="risk-group" class="risk-indicator">
                <p>Grupo de Riesgo: <span id="group-name"></span></p>
            </div>
            
            <p class="mortality-result">
                Mortalidad Observada Estimada: <strong><span id="mortality-rate">0%</span></strong>
            </p>

            <p class="cutoff-info">
                [cite_start]*El punto de corte dicotómico de mayor separación es **9 puntos** (Sensibilidad 0.91, Especificidad 0.40)[cite: 10].
            </p>
        </div>
        
        <footer>
            [cite_start]<p>AUC 0.75 (IC 95% 0.74-0.76)[cite: 9].</p>
            [cite_start]<p>OR por punto: 1.36 (IC 95% 1.35-1.37)[cite: 12].</p>
        </footer>
    </div>
    
    <script>
        /**
         * Lógica de la Calculadora del SCORE PROPIO de Mortalidad en C. Difficile.
         */

        // 1. DATOS Y VARIABLES GLOBALES (Limpios y sin errores de sintaxis)
        const mortalityData = {
            [cite_start]// Datos basados en la tabla de mortalidad [cite: 14]
            '0': '0.3%', 
            '1': '0.3%', 
            '2': '0.6%',
            '3': '0.6%', 
            '4': '1.8%',
            '5': '1.8%', 
            '6': '2.5%',
            '7': '6.1%',
            '8': '7.3%',
            '9': '10.6%',
            '10': '14.3%',
            '11': '17.6%',
            '12': '23.0%',
            '13': '28.3%',
            '14': '33.7%',
            '15': '39.3%',
            [cite_start]'16+': '45.8%' // Agrupado 16 o más [cite: 7, 14]
        }; // <-- Punto y coma (;) VITAL

        const riskGroups = [
            [cite_start]// Grupos de riesgo basados en los cortes [cite: 20]
            { maxScore: 6, name: 'Bajo Riesgo', mortality: '<5% (1.9%)', color: '#4CAF50' }, 
            { maxScore: 10, name: 'Riesgo Medio', mortality: '5-20% (9.7%)', color: '#FF9800' }, 
            { maxScore: Infinity, name: 'Alto Riesgo', mortality: '>20% (25.5%)', color: '#F44336' }
        ]; // <-- Punto y coma (;) VITAL

        // 2. FUNCIÓN DE CÁLCULO
        function calculateScore() { 
            let totalScore = 0;
            
            // Sumar puntos de Checkboxes
            const checkboxes = document.querySelectorAll('#score-form input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                totalScore += parseInt(checkbox.getAttribute('data-points') || 0);
            });
            
            // Sumar puntos de la Edad (Select)
            const ageSelect = document.getElementById('age-select');
            const ageMultiplier = parseInt(ageSelect.value || 0);
            const agePoints = ageMultiplier * parseInt(ageSelect.getAttribute('data-points') || 0);
            totalScore += agePoints;

            // Mostrar Puntuación Total
            document.getElementById('total-score').textContent = totalScore;
            
            // Determinar Mortalidad Observada
            let mortalityRate = '';
            
            if (totalScore >= 16) {
                mortalityRate = mortalityData['16+']; 
            } else if (totalScore >= 0) {
                [cite_start]// Manejar agrupaciones específicas 0-1, 2-3, 4-5, etc. [cite: 14]
                if (totalScore <= 1) mortalityRate = mortalityData['0']; 
                else if (totalScore <= 3 && totalScore >= 2) mortalityRate = mortalityData['2']; 
                else if (totalScore <= 5 && totalScore >= 4) mortalityRate = mortalityData['4']; 
                else {
                     mortalityRate = mortalityData[String(totalScore)] || 'N/A';
                }
            }

            document.getElementById('mortality-rate').textContent = mortalityRate;
            
            // Determinar Grupo de Riesgo y Estilo
            const riskGroupElement = document.getElementById('risk-group');
            const groupNameElement = document.getElementById('group-name');
            let groupFound = false;

            // Limpiar estilos antes de aplicar el nuevo
            riskGroupElement.style.backgroundColor = '#ccc'; 

            riskGroups.forEach(group => {
                if (!groupFound && totalScore <= group.maxScore) {
                    groupNameElement.textContent = `${group.name} (${group.mortality})`; 
                    riskGroupElement.style.backgroundColor = group.color; 
                    groupFound = true;
                }
            });

            // Mostrar el Área de Resultados
            document.getElementById('results-area').classList.remove('hidden');
            
            // Desplazarse hacia los resultados
            document.getElementById('results-area').scrollIntoView({ behavior: 'smooth' });
        }
    </script>
</body>
</html>
